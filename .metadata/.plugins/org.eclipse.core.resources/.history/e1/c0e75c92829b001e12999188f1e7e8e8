<%@ page import="java.sql.*, java.util.*, org.json.simple.*" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Kingdom Survive</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<%
    if ("POST".equals(request.getMethod())) {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/websitedb", "root", "690505");

            // Get data from local storage
            String name = (String) session.getAttribute("name");
            JSONArray sequenceArray = (JSONArray) session.getAttribute("sequence");

            // Database connection and insertion
            String insertQuery = "INSERT INTO users (name, sequence, date, gold, food, soldiers, happiness, ac1, ac2, ac3, ac4, ac5, ac6, ac7, ac8, ac9, ac10) VALUES (?, ?, 1, 15, 15, 10, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)";

            try (PreparedStatement pstmt = conn.prepareStatement(insertQuery)) {
                pstmt.setString(1, name);
                pstmt.setObject(2, sequenceArray); // Set JSON array directly
                pstmt.executeUpdate();
            }

            conn.close();

            response.sendRedirect("lobby.jsp");
        } catch (ClassNotFoundException | SQLException e) {
            e.printStackTrace();
        }
    }
%>

</body>
</html>

