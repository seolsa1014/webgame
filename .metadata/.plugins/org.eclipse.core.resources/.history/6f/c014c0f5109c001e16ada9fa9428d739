<%@ page import="java.sql.*, java.io.*, java.util.*" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <meta charset="UTF-8">
    <title>Castle Page</title>
    <link rel="stylesheet" type="text/css" href="css/day.css">
    <script>
        function redirectToNextPage() {
            // 여기에서 다음 페이지로 이동하는 로직을 추가
            // 예를 들어, day12.jsp로 이동한다면:
            window.location.href = 'day12.jsp';
        }
    </script>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 800px;
            background: url('css/day10.png') center/100% 100% no-repeat;
        }
    </style>
</head>
<body>
    <%
        // 이전 코드 생략

        // 선택지에 따라 데이터베이스 업데이트
        String selectedOption = request.getParameter("option");
        if ("option1".equals(selectedOption)) {
            // 옵션 1: 어떤 업데이트 작업
        } else if ("option2".equals(selectedOption)) {
            // 옵션 2: 어떤 업데이트 작업
        } else if ("option3".equals(selectedOption)) {
            // 옵션 3: 어떤 업데이트 작업
        }

        // date가 30인 경우 처리
        String updateDateQuery = "UPDATE users SET date = date + 1 WHERE name = ?";
        pstmt = conn.prepareStatement(updateDateQuery);
        pstmt.setString(1, loggedInName);
        pstmt.executeUpdate();

        // 데이터베이스에서 해당 사용자의 정보 조회
        String query = "SELECT sequence, date FROM users WHERE name = ?";
        pstmt = conn.prepareStatement(query);
        pstmt.setString(1, loggedInName);
        rs = pstmt.executeQuery();

        if (rs.next()) {
            // sequence와 date 가져오기
            String sequenceString = rs.getString("sequence");
            int date = rs.getInt("date");

            // JSON 문자열을 JSON 배열로 파싱
            JSONParser parser = new JSONParser();
            JSONArray sequenceArray = (JSONArray) parser.parse(sequenceString);

            // date에 해당하는 값을 가져오기

            // date가 30이면 0으로 업데이트하고 ending.html로 리디렉션
            if (date == 31) {
                String resetDateQuery = "UPDATE users SET date = 0 WHERE name = ?";
                pstmt = conn.prepareStatement(resetDateQuery);
                pstmt.setString(1, loggedInName);
                pstmt.executeUpdate();

                response.sendRedirect("ending.html");
            } else {
                long value = (long) sequenceArray.get(date - 1);
                // dayX.jsp로 이동
                String nextPage = "day" + value + ".jsp";
                response.sendRedirect(nextPage);
            }
        } else {
            // 사용자 정보가 없는 경우, 처리할 내용 추가
            response.sendRedirect("load.jsp");
        }

        // 여기에서 다음 페이지로 이동하는 로직을 추가
        // 예를 들어, day12.jsp로 이동한다면:
        // response.sendRedirect("day12.jsp");
    %>
</body>
</html>


